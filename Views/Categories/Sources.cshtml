@model CategorySourcesViewModel

@{
    ViewData["Title"] = $"Свързани източници към категория „{Model.CurrentCategory.Name}“";
    Layout = "~/Views/Shared/_LayoutLibrary.cshtml";
}

@section breadcrumb {
    <a asp-controller="Categories" asp-action="Index">Категории</a>

    <span class="separator">/</span>

    <a asp-action="Details" asp-controller="Categories" asp-route-id="@Model.CurrentCategory.Id">@Model.CurrentCategory.Name</a>

    <span class="separator">/</span>

    <a asp-action="Sources" asp-controller="Categories" asp-route-id="@Model.CurrentCategory.Id">Свързани източници</a>
}

<div class="blog-main col-md-11">

    <h2>@Model.CurrentCategory.Name</h2>

    <pre class="help-block">@Model.CurrentCategory.Description</pre>

    <hr />
    
    @if (Model.Records.Any())
    {
        <table class="table table-striped table-bordered">
            <thead>
                <tr class="info">
                    @if (User.Is(StranitzaRoles.Administrator))
                    {
                        <th style="width: 40px;" str-sortable-for="Id">№</th>
                    }
                    <th str-sortable-for="Title">Заглавие</th>
                    <th str-sortable-for="Origin">Произход</th>
                    <th str-sortable-for="Uploader">Качил</th>
                    @*<th style="width: 120px;" str-sortable-for="LastUpdated">Промяна на</th>*@
                    <th class="text-center" style="width: 120px;" str-sortable-for="DateCreated">Създаден</th>
                </tr>
            </thead>
            <tbody>

            @foreach (var source in Model.Records)
            {
                var hasTitle = !string.IsNullOrEmpty(source.Title);

                <tr class="source-row @(!hasTitle ? "warning" : string.Empty)">
                    @if (User.Is(StranitzaRoles.Administrator))
                    {
                        <td>@source.Id</td>
                    }

                    @if (hasTitle)
                    {
                        <td><a asp-action="Details" asp-controller="Sources" asp-route-id="@source.Id">@source.Title<sup><i class="fa fa-external-link"></i></sup></a></td>
                    }
                    else
                    {
                        <td><a asp-action="Edit" asp-controller="Sources" asp-route-id="@source.Id"><b>ЛИПСВА ЗАГЛАВИЕ</b><sup><i class="fa fa-edit"></i></sup></a></td>
                    }

                    @if (!string.IsNullOrEmpty(source.AuthorId))
                    {
                        /* TODO: Link to profile */
                        <td><a href="#">@source.Origin<sup><i class="fa fa-user"></i></sup></a></td>
                    }
                    else
                    {
                        <td>@source.Origin</td>
                    }

                    <td class="text-center">@source.Uploader</td>
                    @*<td class="text-center">@source.LastUpdated.ToString("dd.MM.yyyy HH:mm")</td>*@
                    <td class="text-center">@source.DateCreated.ToString("dd.MM.yyyy HH:mm")</td>
                </tr>

            }
            </tbody>
        </table>
    }
    else
    {
        <p>
            Няма намерени свързани източници към категорията.
        </p>
    }
    
    @*<partial name="_Paging" model="Model" view-data='new ViewDataDictionary(ViewData) { { "Next", "Напред" }, { "Previous", "Назад" } }'/>*@
    @await Html.PartialAsync("_Paging", Model, new ViewDataDictionary(ViewData) { { "Next", "Напред" }, { "Previous", "Назад" } })
    
</div>